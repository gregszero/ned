<div class="flex flex-col h-full"
     data-controller="conversation"
     data-conversation-id-value="<%= @conversation.id %>"
     data-conversation-page-id-value="<%= @conversation.ai_page&.id %>">
  <div class="mb-4">
    <a href="/" class="text-sm">&larr; Back</a>
    <h2 class="text-2xl font-semibold tracking-tight mt-1"><%= @conversation.title || "Conversation ##{@conversation.id}" %></h2>
    <div class="flex gap-3 mt-2">
      <span class="badge"><%= @conversation.source %></span>
      <span class="text-xs text-fang-muted-fg"><%= @conversation.messages.count %> messages</span>
      <span class="text-xs text-fang-muted-fg">Started <%= @conversation.created_at.strftime('%b %d, %Y') %></span>
    </div>
  </div>

  <div class="flex-1 overflow-hidden border border-fang-border rounded-lg bg-fang-card">
    <div id="messages-<%= @conversation.id %>" data-conversation-target="messages" class="messages h-full overflow-y-auto p-4 flex flex-col gap-3">
      <% if @messages.empty? %>
        <div class="py-16 text-center">
          <p class="text-fang-muted-fg">No messages yet. Start the conversation below!</p>
        </div>
      <% else %>
        <% @messages.each do |message| %>
          <%= render '_message', locals: { message: message } %>
        <% end %>
      <% end %>
    </div>
  </div>

  <div class="mt-4">
    <turbo-frame id="message-form">
      <form action="/conversations/<%= @conversation.id %>/messages" method="post" class="flex gap-3"
            data-turbo="true"
            data-action="turbo:submit-end->conversation#scrollToBottom">
        <input type="hidden" name="turbo" value="1">
        <textarea
          name="content"
          placeholder="Type your message..."
          rows="3"
          required
          autofocus
          class="flex-1 min-w-0"
        ></textarea>
        <button type="submit" class="self-end shrink-0">Send</button>
      </form>
    </turbo-frame>
  </div>
</div>
