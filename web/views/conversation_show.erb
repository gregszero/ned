<div class="flex flex-col h-[calc(100vh-10rem)]">
  <div class="mb-4">
    <a href="/conversations" class="link link-primary text-sm">‚Üê Back to conversations</a>
    <h2 class="text-2xl font-bold mt-1"><%= @conversation.title || "Conversation ##{@conversation.id}" %></h2>
    <div class="flex gap-3 mt-1">
      <div class="badge badge-outline"><%= @conversation.source %></div>
      <span class="text-sm text-base-content/50"><%= @conversation.messages.count %> messages</span>
      <span class="text-sm text-base-content/50">Started <%= @conversation.created_at.strftime('%b %d, %Y') %></span>
    </div>
  </div>

  <div class="flex-1 overflow-hidden bg-base-100 rounded-box border border-base-content/10">
    <div id="messages" class="messages h-full overflow-y-auto p-4 flex flex-col gap-3">
      <% if @messages.empty? %>
        <div class="hero py-16">
          <p class="text-base-content/50">No messages yet. Start the conversation below!</p>
        </div>
      <% else %>
        <% @messages.each do |message| %>
          <%= render '_message', locals: { message: message } %>
        <% end %>
      <% end %>
    </div>
  </div>

  <div class="mt-4">
    <turbo-frame id="message-form">
      <form action="/conversations/<%= @conversation.id %>/messages" method="post" class="flex gap-3" data-turbo="true">
        <input type="hidden" name="turbo" value="1">
        <textarea
          name="content"
          placeholder="Type your message..."
          rows="3"
          required
          autofocus
          class="textarea textarea-bordered flex-1 text-base"
        ></textarea>
        <button type="submit" class="btn btn-primary self-end">Send</button>
      </form>
    </turbo-frame>
  </div>
</div>

<script>
  document.addEventListener('turbo:load', () => {
    const messages = document.querySelector('.messages');
    if (messages) {
      messages.scrollTop = messages.scrollHeight;
    }
  });

  document.addEventListener('turbo:before-stream-render', () => {
    setTimeout(() => {
      const messages = document.querySelector('.messages');
      if (messages) {
        messages.scrollTop = messages.scrollHeight;
      }
    }, 100);
  });
</script>
