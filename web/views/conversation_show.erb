<div class="flex flex-col h-[calc(100dvh-10rem)]"
     data-controller="conversation"
     data-conversation-id-value="<%= @conversation.id %>">
  <div class="mb-4">
    <a href="/conversations" class="text-sm">&larr; Back to conversations</a>
    <h2 class="text-3xl md:text-5xl mt-1"><%= @conversation.title || "Conversation ##{@conversation.id}" %></h2>
    <div class="flex gap-3 mt-2">
      <span class="badge"><%= @conversation.source %></span>
      <span class="text-xs" style="color:var(--ned-muted-fg);"><%= @conversation.messages.count %> messages</span>
      <span class="text-xs" style="color:var(--ned-muted-fg);">Started <%= @conversation.created_at.strftime('%b %d, %Y') %></span>
    </div>
  </div>

  <div class="flex-1 overflow-hidden border-2 border-ned-border" style="background:var(--ned-card);">
    <div id="messages" data-conversation-target="messages" class="messages h-full overflow-y-auto p-4 flex flex-col gap-3">
      <% if @messages.empty? %>
        <div class="py-16 text-center">
          <p style="color:var(--ned-muted-fg);">No messages yet. Start the conversation below!</p>
        </div>
      <% else %>
        <% @messages.each do |message| %>
          <%= render '_message', locals: { message: message } %>
        <% end %>
      <% end %>
    </div>
  </div>

  <div class="mt-4">
    <turbo-frame id="message-form">
      <form action="/conversations/<%= @conversation.id %>/messages" method="post" class="flex gap-3"
            data-turbo="true"
            data-action="turbo:submit-end->conversation#scrollToBottom">
        <input type="hidden" name="turbo" value="1">
        <textarea
          name="content"
          placeholder="Type your message..."
          rows="3"
          required
          autofocus
          class="flex-1 min-w-0"
        ></textarea>
        <button type="submit" class="self-end shrink-0">Send</button>
      </form>
    </turbo-frame>
  </div>
</div>
